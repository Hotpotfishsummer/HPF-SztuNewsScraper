# src/web - Web UI æ¨¡å—ï¼ˆStreamlitï¼‰

## æ¦‚è¿°

`src/web` æ¨¡å—å®ç°åº”ç”¨çš„ Web ç”¨æˆ·ç•Œé¢ï¼Œä½¿ç”¨ Streamlit æ¡†æ¶æ„å»ºäº¤äº’å¼åº”ç”¨ã€‚æä¾›ä¸€ä¸ªå‹å¥½çš„å›¾å½¢ç•Œé¢æ¥è®¿é—®çˆ¬è™«ã€åˆ†æã€æœç´¢ç­‰åŠŸèƒ½ã€‚

## ç›®å½•ç»“æ„

```
src/web/
â”œâ”€â”€ __init__.py         # Web æ¨¡å—åˆå§‹åŒ–
â”œâ”€â”€ app.py             # Streamlit ä¸»åº”ç”¨
â”œâ”€â”€ pages/             # å¤šé¡µé¢åº”ç”¨é¡µé¢
â”‚   â”œâ”€â”€ home.py        # é¦–é¡µä»ªè¡¨ç›˜
â”‚   â”œâ”€â”€ scraper.py     # çˆ¬è™«é¡µé¢
â”‚   â”œâ”€â”€ articles.py    # æ–‡ç« æµè§ˆ
â”‚   â”œâ”€â”€ search.py      # æœç´¢é¡µé¢
â”‚   â”œâ”€â”€ analysis.py    # AI åˆ†æé¡µé¢
â”‚   â””â”€â”€ settings.py    # è®¾ç½®é¡µé¢
â”œâ”€â”€ components/        # å¯å¤ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ article_display.py    # æ–‡ç« æ˜¾ç¤ºç»„ä»¶
â”‚   â”œâ”€â”€ search_form.py        # æœç´¢è¡¨å•ç»„ä»¶
â”‚   â””â”€â”€ analysis_results.py   # åˆ†æç»“æœç»„ä»¶
â””â”€â”€ assets/           # é™æ€èµ„æº
    â”œâ”€â”€ css/
    â”œâ”€â”€ images/
    â””â”€â”€ icons/
```

## æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

### app.py - ä¸»åº”ç”¨å…¥å£

**åŠŸèƒ½**: Streamlit åº”ç”¨çš„ä¸»å…¥å£ç‚¹ï¼Œé…ç½®é¡µé¢å’Œå¯¼èˆª

**é…ç½®**:
```python
# é¡µé¢é…ç½®
st.set_page_config(
    page_title="SZTU æ–°é—»çˆ¬è™«",
    page_icon="ğŸ“°",
    layout="wide",
    initial_sidebar_state="expanded"
)

# å¤šé¡µé¢è®¾ç½®
st.navigation([
    st.Page("pages/home.py", title="é¦–é¡µ", icon="ğŸ "),
    st.Page("pages/scraper.py", title="çˆ¬è™«", icon="ğŸ”"),
    st.Page("pages/articles.py", title="æ–‡ç« ", icon="ğŸ“°"),
    st.Page("pages/search.py", title="æœç´¢", icon="ğŸ”"),
    st.Page("pages/analysis.py", title="åˆ†æ", icon="ğŸ¤–"),
    st.Page("pages/settings.py", title="è®¾ç½®", icon="âš™ï¸"),
])
```

### pages/home.py - é¦–é¡µä»ªè¡¨ç›˜

**åŠŸèƒ½**: åº”ç”¨é¦–é¡µï¼Œæ˜¾ç¤ºç³»ç»Ÿæ¦‚è§ˆå’Œå¿«é€Ÿç»Ÿè®¡

**å†…å®¹**:
- ç»Ÿè®¡ä¿¡æ¯ï¼ˆæ–‡ç« æ•°ã€åˆ†ææ•°ã€æœ€åæ›´æ–°æ—¶é—´ï¼‰
- å¿«é€Ÿæ“ä½œæŒ‰é’®ï¼ˆå¼€å§‹çˆ¬è™«ã€æŸ¥çœ‹æœ€æ–°ã€åˆ†æï¼‰
- æœ€è¿‘æ´»åŠ¨æ—¥å¿—
- ç³»ç»ŸçŠ¶æ€æŒ‡ç¤º

**ç¤ºä¾‹ä»£ç **:
```python
import streamlit as st
from core.config import get_config

st.title("ğŸ“° SZTU æ–°é—»çˆ¬è™« - é¦–é¡µ")

# ç»Ÿè®¡ä¿¡æ¯
col1, col2, col3, col4 = st.columns(4)
with col1:
    st.metric("æ€»æ–‡ç« æ•°", 250, "+5")
with col2:
    st.metric("å·²åˆ†æ", 180, "+3")
with col3:
    st.metric("åˆ†æè¯„åˆ†", "7.8/10", "â†‘0.2")
with col4:
    st.metric("æœ€åæ›´æ–°", "2å°æ—¶å‰")

# å¿«é€Ÿæ“ä½œ
st.subheader("å¿«é€Ÿæ“ä½œ")
col1, col2, col3 = st.columns(3)
with col1:
    if st.button("ğŸ” å¼€å§‹çˆ¬è™«"):
        st.switch_page("pages/scraper.py")
with col2:
    if st.button("ğŸ“° æŸ¥çœ‹æœ€æ–°"):
        st.switch_page("pages/articles.py")
with col3:
    if st.button("ğŸ¤– AI åˆ†æ"):
        st.switch_page("pages/analysis.py")
```

### pages/scraper.py - çˆ¬è™«é¡µé¢

**åŠŸèƒ½**: æ–°é—»çˆ¬è™«çš„å›¾å½¢åŒ–ç•Œé¢

**åŠŸèƒ½**:
- é¡µæ•°è¾“å…¥å’ŒéªŒè¯
- çˆ¬è™«ç±»å‹é€‰æ‹©ï¼ˆJSON æˆ–å®Œæ•´ï¼‰
- å®æ—¶è¿›åº¦æ˜¾ç¤º
- çˆ¬è™«ç»“æœå±•ç¤º

**ç¤ºä¾‹ç•Œé¢**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” çˆ¬è™«è®¾ç½®                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ çˆ¬è™«ç±»å‹ï¼šâ—‹ JSON æ ¼å¼  â— å®Œæ•´å†…å®¹       â”‚
â”‚ é¡µæ•°ï¼š[____] (1-10)                     â”‚
â”‚ â–¡ æ›´æ–°ç°æœ‰æ–‡ç«                           â”‚
â”‚ [å¼€å§‹çˆ¬è™«]                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¿›åº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80%                    â”‚
â”‚ å·²çˆ¬å–: 48 ç¯‡ / é¢„è®¡ 60 ç¯‡              â”‚
â”‚ è€—æ—¶: 2åˆ† 34ç§’                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### pages/articles.py - æ–‡ç« æµè§ˆ

**åŠŸèƒ½**: æµè§ˆå’ŒæŸ¥çœ‹å·²çˆ¬å–çš„æ–‡ç« 

**åŠŸèƒ½**:
- æ–‡ç« åˆ—è¡¨ï¼ˆåˆ†é¡µæ˜¾ç¤ºï¼‰
- åˆ†ç±»/éƒ¨é—¨ç­›é€‰
- æ—¶é—´èŒƒå›´ç­›é€‰
- æ–‡ç« è¯¦æƒ…å±•ç¤º
- å¯¼å‡ºé€‰é¡¹

**ç¤ºä¾‹ç•Œé¢**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆ†ç±»ç­›é€‰ â”‚ éƒ¨é—¨ç­›é€‰ â”‚ æ—¶é—´èŒƒå›´ â”‚ [å¯¼å‡º] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 
â”‚ 1. [æ–°é—»] æ·±åœ³æŠ€æœ¯å¤§å­¦æ–°é—»é€šçŸ¥
â”‚    éƒ¨é—¨: æ ¡é•¿åŠå…¬å®¤ | 2024-01-07
â”‚    [æŸ¥çœ‹è¯¦æƒ…]
â”‚
â”‚ 2. [é€šçŸ¥] å…³äºå­¦æœŸè°ƒæ•´çš„é€šçŸ¥
â”‚    éƒ¨é—¨: æ•™åŠ¡å¤„ | 2024-01-06
â”‚    [æŸ¥çœ‹è¯¦æƒ…]
â”‚
â”‚ ç¬¬ 1 é¡µ / 10 é¡µ  [ä¸Šä¸€é¡µ] [ä¸‹ä¸€é¡µ]
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### pages/search.py - æœç´¢é¡µé¢

**åŠŸèƒ½**: æœç´¢å’Œè¿‡æ»¤æ–‡ç« 

**æœç´¢æ–¹å¼**:
- æŒ‰æ ‡é¢˜å…³é”®è¯æœç´¢
- æŒ‰ URL æœç´¢
- æŒ‰åˆ†ç±»æœç´¢
- æŒ‰éƒ¨é—¨æœç´¢
- é«˜çº§æœç´¢ï¼ˆç»„åˆæ¡ä»¶ï¼‰

**ç¤ºä¾‹ç•Œé¢**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” æ–‡ç« æœç´¢                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æœç´¢ç±»å‹ï¼š
â”‚ â—‹ æ ‡é¢˜  â—‹ URL  â—‹ é«˜çº§æœç´¢
â”‚
â”‚ å…³é”®è¯: [________________]
â”‚ [æœç´¢]
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 
â”‚ æœç´¢ç»“æœ: 5 ç¯‡
â”‚
â”‚ 1. æ–‡ç« æ ‡é¢˜ 1
â”‚    - å‘å¸ƒæ—¶é—´: 2024-01-07
â”‚    - é“¾æ¥: https://...
â”‚
â”‚ 2. æ–‡ç« æ ‡é¢˜ 2
â”‚    ...
â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### pages/analysis.py - AI åˆ†æé¡µé¢

**åŠŸèƒ½**: AI æ–°é—»ç›¸å…³æ€§åˆ†æ

**åŠŸèƒ½**:
- å•ç¯‡æ–‡ç« åˆ†æ
- æ‰¹é‡åˆ†æ
- åˆ†æå†å²æŸ¥çœ‹
- åˆ†æç»Ÿè®¡å±•ç¤º
- ç»“æœå¯¼å‡º

**åˆ†ææµç¨‹**:
```
1. é€‰æ‹©åˆ†ææ¨¡å¼ï¼ˆå•ç¯‡/æ‰¹é‡ï¼‰
2. é€‰æ‹©æ–‡ç« ï¼ˆä¸‹æ‹‰åˆ—è¡¨ï¼‰
3. ç‚¹å‡»"åˆ†æ"æŒ‰é’®
4. æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
5. æ˜¾ç¤ºåˆ†æç»“æœï¼š
   - ç›¸å…³æ€§è¯„åˆ†
   - åˆ†ææ‘˜è¦
   - è¯„åˆ†åŸå› 
   - æ—¶é—´æˆ³
```

### pages/settings.py - è®¾ç½®é¡µé¢

**åŠŸèƒ½**: åº”ç”¨é…ç½®å’Œç³»ç»Ÿè®¾ç½®

**è®¾ç½®é¡¹**:
- API å¯†é’¥ï¼ˆGeminiã€Difyï¼‰
- æ—¥å¿—çº§åˆ«
- çˆ¬è™«è¶…æ—¶æ—¶é—´
- åˆ†ææ¨¡å‹é€‰æ‹©
- æ•°æ®å¤‡ä»½
- æ¸…é™¤ç¼“å­˜

**ç¤ºä¾‹ç•Œé¢**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš™ï¸ ç³»ç»Ÿè®¾ç½®                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 
â”‚ API é…ç½®
â”‚ â”œâ”€ Gemini API Key: [***]
â”‚ â”œâ”€ Dify API Key: [***]
â”‚ â””â”€ [æµ‹è¯•è¿æ¥]
â”‚
â”‚ çˆ¬è™«é…ç½®
â”‚ â”œâ”€ è¶…æ—¶æ—¶é—´: [_____] ç§’
â”‚ â”œâ”€ æœ€å¤§é‡è¯•: [_____] æ¬¡
â”‚ â””â”€ å»¶è¿Ÿ: [_____] æ¯«ç§’
â”‚
â”‚ æ—¥å¿—é…ç½®
â”‚ â”œâ”€ æ—¥å¿—çº§åˆ«: [DEBUG    â–¼]
â”‚ â”œâ”€ æ—¥å¿—ä½ç½®: ./logs/
â”‚ â””â”€ [æŸ¥çœ‹æ—¥å¿—]
â”‚
â”‚ [ä¿å­˜è®¾ç½®]  [æ¢å¤é»˜è®¤]
â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å¯å¤ç”¨ç»„ä»¶

### article_display.py

**ç»„ä»¶å‡½æ•°**:
- `display_article(article_data)` - æ˜¾ç¤ºå•ç¯‡æ–‡ç« 
- `display_article_list(articles, per_page=10)` - æ˜¾ç¤ºæ–‡ç« åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
- `article_card(article)` - æ–‡ç« å¡ç‰‡ç»„ä»¶

### search_form.py

**ç»„ä»¶å‡½æ•°**:
- `search_form()` - æœç´¢è¡¨å•
- `advanced_search_form()` - é«˜çº§æœç´¢
- `filter_sidebar()` - è¿‡æ»¤ä¾§è¾¹æ 

### analysis_results.py

**ç»„ä»¶å‡½æ•°**:
- `display_analysis_result(result)` - æ˜¾ç¤ºå•ä¸ªåˆ†æç»“æœ
- `analysis_history_table(records)` - åˆ†æå†å²è¡¨æ ¼
- `statistics_dashboard(stats)` - ç»Ÿè®¡ä»ªè¡¨æ¿

## çŠ¶æ€ç®¡ç†

Streamlit ä½¿ç”¨ `st.session_state` ç®¡ç†åº”ç”¨çŠ¶æ€ï¼š

```python
# åˆå§‹åŒ–çŠ¶æ€
if 'search_results' not in st.session_state:
    st.session_state.search_results = []

if 'current_page' not in st.session_state:
    st.session_state.current_page = 1

# æ›´æ–°çŠ¶æ€
st.session_state.search_results = results
```

## å¯åŠ¨ Web UI

```bash
# ç›´æ¥å¯åŠ¨
streamlit run src/web/app.py

# é€šè¿‡æœåŠ¡æ¨¡å¼å¯åŠ¨
python src/entry/service.py --web-only

# ä½¿ç”¨ Docker
docker-compose up web
```

### å¯åŠ¨å‚æ•°

```bash
# æŒ‡å®šä¸»æœºå’Œç«¯å£
streamlit run src/web/app.py --server.address=0.0.0.0 --server.port=8501

# ç¦ç”¨æµè§ˆå™¨è‡ªåŠ¨æ‰“å¼€
streamlit run src/web/app.py --logger.level=info --client.showErrorDetails=false
```

## é…ç½®æ–‡ä»¶

Streamlit é…ç½®æ–‡ä»¶: `~/.streamlit/config.toml`

```toml
[browser]
gatherUsageStats = false

[logger]
level = "info"

[server]
headless = true
enableXsrfProtection = false
```

## ç¯å¢ƒå˜é‡

```env
# Streamlit é…ç½®
STREAMLIT_SERVER_PORT=8501
STREAMLIT_SERVER_ADDRESS=0.0.0.0
STREAMLIT_LOGGER_LEVEL=info

# åº”ç”¨é…ç½®
STREAMLIT_PAGE_TITLE=SZTU News
STREAMLIT_PAGE_ICON=ğŸ“°
```

## æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜ä¼˜åŒ–
ä½¿ç”¨ Streamlit çš„ç¼“å­˜è£…é¥°å™¨ï¼š

```python
@st.cache_data(ttl=3600)  # ç¼“å­˜ 1 å°æ—¶
def load_articles():
    return get_all_articles_from_index()

@st.cache_resource  # ç¼“å­˜æ•´ä¸ªä¼šè¯
def get_config():
    return load_config()
```

### é¡µé¢ä¼˜åŒ–
```python
# ä½¿ç”¨ columns å’Œ expander æ§åˆ¶åˆå§‹åŠ è½½
col1, col2 = st.columns(2)

with col1:
    st.write("å†…å®¹1")

with col2:
    with st.expander("ç‚¹å‡»å±•å¼€è¯¦æƒ…"):
        st.write("å»¶è¿ŸåŠ è½½çš„å†…å®¹")
```

## ä¾èµ–å…³ç³»

```
web/
  â”œâ”€ streamlit (Web æ¡†æ¶)
  â”œâ”€ pandas (æ•°æ®å±•ç¤º)
  â”œâ”€ plotly (å›¾è¡¨)
  â”œâ”€ core.logger â†’ æ—¥å¿—
  â”œâ”€ core.config â†’ é…ç½®
  â”œâ”€ core.scraper â†’ çˆ¬è™«åŠŸèƒ½
  â”œâ”€ core.analyzer â†’ AI åˆ†æ
  â””â”€ storage â†’ æ•°æ®è¯»å–
```

## æµè§ˆå™¨å…¼å®¹æ€§

- Chrome / Chromium: âœ… å®Œå…¨æ”¯æŒ
- Firefox: âœ… å®Œå…¨æ”¯æŒ
- Safari: âœ… å®Œå…¨æ”¯æŒ
- Edge: âœ… å®Œå…¨æ”¯æŒ
- IE 11: âŒ ä¸æ”¯æŒ

## å°†æ¥çš„åŠŸèƒ½

- æš—è‰²ä¸»é¢˜æ”¯æŒ
- å¯¼å‡ºä¸º PDF æŠ¥å‘Š
- å®æ—¶é€šçŸ¥
- WebSocket å®æ—¶æ›´æ–°
- ç§»åŠ¨ç«¯å“åº”å¼è®¾è®¡
- ç”¨æˆ·è®¤è¯å’Œæƒé™

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•è‡ªå®šä¹‰ä¸»é¢˜ï¼Ÿ
A: ç¼–è¾‘ `.streamlit/config.toml` ä¸­çš„ä¸»é¢˜é…ç½®

### Q: å¦‚ä½•æ·»åŠ æ–°é¡µé¢ï¼Ÿ
A: åœ¨ `pages/` ç›®å½•ä¸­åˆ›å»ºæ–°æ–‡ä»¶ï¼ŒStreamlit ä¼šè‡ªåŠ¨è¯†åˆ«

### Q: å¦‚ä½•éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼Ÿ
A: ä½¿ç”¨ Streamlit Cloud æˆ– Docker å®¹å™¨åŒ–éƒ¨ç½²

